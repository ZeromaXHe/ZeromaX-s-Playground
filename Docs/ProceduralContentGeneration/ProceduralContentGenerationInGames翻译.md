原文档来源：https://www.pcgbook.com/



# 前言

欢迎阅读《游戏中的程序内容生成》一书。（【1】：在本书中，我们经常使用PCG作为程序内容生成的缩写。）据我们所知，这是第一本关于游戏中程序内容生成的教科书。据我们所知，这也是第一本对研究领域进行综述的书。我们希望你觉得它有用，无论你是在一门课程中学习，自己学习，还是作为一名研究人员。

我们写这本书有两个原因。第一个原因是我们三个人都在研究游戏中的 PCG，我们想要一个好的概述。由于我们来自不同的方法论背景，我们意识到许多研究人员不知道其他社区开发的方法。例如，使用逻辑编程和进化计算的研究人员可能不知道其他类型的算法适用于同一问题；来自计算机图形学的研究人员甚至可能不知道人工智能方法正在用于 PCG 问题。由于游戏中的 PCG 最近才开始被视为自己的研究领域，这并不奇怪，但这表明需要一本这样的书。

第二个原因是，我们正在哥本哈根信息技术大学教授一门关于 PCG 的课程（事实上，题为“游戏中的程序性内容生成”），当时我们三人都是该大学的教员。当这门课程于 2010 年开始时，它可能是世界上第一门此类课程。当然，没有教科书可以教它，所以我们用学术论文（主要是最近的论文）编写了一个教学大纲。随着我们在随后的几年里教授这门课程，教学大纲逐渐成熟，我们觉得我们已经准备好将讲座内容变成教科书了。

在写这本书时，我们以现有课程的结构为基础。事实上，这本教科书的初稿是在 2013 年秋季作为该课程第四次迭代的一部分而编写的。每章的草稿都在相应的讲座之前完成，并作为讲义分发，以配合讲座。这确保了教科书的完整草稿在一个学期内完成，也许更重要的是确保了这本书被设计成教科书。不幸的是，添加润色和完成每一章花了更长的时间，这解释了为什么这本书没有在 2014 年出版。然而，我们认为，为这本书增加的时间是值得的，因为最终的作品比早期的草稿要好得多。

正如您将看到的，这本书并没有严格按照方法或应用领域进行划分。大多数章节都介绍了领域和方法。以下是我们如何构建 PCG 课程的结构，我们这样做是为了使课程更具吸引力和更容易教授：新方法与有趣和相关的领域一起被引入，这些领域展示了它们为什么是实用的，可以用作实验室练习的设置，以进一步实验这些方法。

我们很早就决定，我们想让研究领域中许多最活跃的人参与进来，特别是那些写过我们最初教授课程时所依赖的论文的人。因此，大多数章节都是与其他研究人员合著的。这确保了我们拥有与每章主题最相关的专业知识。

如上所述，这本书的主要目的之一是作为教科书。它作为一套课程笔记的起源也有助于确保这本书经过“战斗考验”，并准备从中教学。特别是，这本书可以作为研究生阶段或高级本科阶段游戏程序内容生成课程的主要课程文本。假设学生熟悉基本的人工智能概念（特别是启发式搜索以及逻辑和机器学习的基本概念），并且学生有一些游戏开发和使用游戏引擎的经验是非常有益的（尽管不是严格必要的）。

这本书可以通过多种方式用作课程文献。一种方法是将每节课建立在特定章节的基础上，并从与该章节相关的文献中指定几篇最近的论文作为该周的补充阅读。然后，每章末尾的作业可以用作本周的作业，课程结束时可以举行传统的纸笔考试。另一种组织此类课程的方式，与哥本哈根信息技术大学的原始课程教学方式更紧密地保持一致，可以在学期的前半段进行强化讲座，每周涵盖两章。学期的后半段用于小组项目。（【2】：该课程的小组项目产出了许多优秀的论文。）最后，你总是可以使用这本书的部分内容，例如，如果你想把 PCG 作为游戏人工智能更大课程的一部分来教授。大多数章节都是相当独立的，最重要的依赖关系是前两章，这两章建立了核心概念和术语。因此，建议从第 1 章和第 2 章开始，即使只使用本书的部分内容。

这本书附有一个网页 pcgbook.com，其中包含本书章节的数字版本，以及示例讲座幻灯片、相关邮件组和会议的链接以及其他补充材料。我们欢迎对添加到网站的新补充材料（例如您自己的讲座幻灯片）提出建议。我们的最新联系信息也可以在那里找到。

当然，在任何书本大小的努力中，都需要大量其他人的帮助。我们首先要感谢本书各章节的合作者和合著者。我们也非常感谢 PCG 课程的学生，他们忍受了这本书的各种草稿版本，以及我们的实际讲座，并在许多情况下提供了非常有用的反馈。其他几位同事提供了有用的反馈或以其他方式提供了帮助；名单上包括史蒂夫·达尔斯科、艾米·胡佛和亚伦·伊萨克森（Steve Dahlskog, Amy Hoover and Aaron Isaksen）。



努尔·沙克尔、朱利安·托格里厄斯和马克·纳尔逊

*Noor Shaker, Julian Togelius, and Mark Nelson*

# 第 1 章 介绍

Julian Togelius, Noor Shaker, and Mark J. Nelson

**摘要**

本章介绍了过程内容生成（PCG）领域以及本书。我们首先定义关键术语，如游戏内容和程序生成。然后，我们给出了使用 PCG 的游戏示例，概述了所需的属性，并提供了不同类型 PCG 的分类。PCG 的应用和方法可以用许多不同的方式来描述，另一节专门从设计隐喻的角度来看待 PCG。本章最后概述了本书的其余部分。

## 1.1 什么是程序内容生成？

您刚刚开始阅读一本关于游戏中程序性内容生成的书。这本书将包含相当多的算法和其他技术内容，以及大量关于游戏设计的讨论。但在我们进入这本书的核心之前，让我们先从一些更枯燥的东西开始：定义。特别是，让我们定义过程内容生成，我们将经常缩写为 PCG。我们将使用的定义是，PCG 是有限或间接用户输入的游戏内容的算法创建[32]。换言之，PCG 是指可以自己或与一个或多个人类玩家或设计师一起创建游戏内容的计算机软件。

这里的一个关键术语是“内容”。在我们的定义中，内容是游戏中包含的大部分内容：关卡、地图、游戏规则、纹理、故事、物品、任务、音乐、武器、车辆、角色等。在我们的定义中，游戏引擎本身并不被认为是内容。此外，非玩家角色行为（NPC AI）也不被视为内容。内容定义范围缩小的原因是，在游戏中的人工智能和计算智能领域，将 CI 和 AI 方法应用于角色行为的研究比程序内容生成的研究要多得多。虽然 PCG 领域主要基于人工智能方法，但我们希望将其与更“主流”的使用基于游戏的任务来测试人工智能算法区分开来，在这种情况下，人工智能最常用于学习玩游戏。与所有定义一样（也许数学中的定义除外），我们对 PCG 的定义有点武断，而且边缘相当模糊。我们将这样对待它，并注意到其他人对这个词的定义不同。特别是，有些人更愿意使用“生成方法”一词来指代我们所说的 PCG 的超集[8]。

另一个重要术语是“游戏”。众所周知，游戏很难定义（见维特根斯坦对这个问题的讨论[36]），我们在这里不会尝试。简而言之，我们所说的游戏是指电子游戏、电脑游戏、棋盘游戏、纸牌游戏、谜题等。重要的是，内容生成系统要考虑到它所生成的游戏的设计、启示和约束。这使 PCG 有别于生成艺术和许多类型的计算机图形学，它们没有考虑到游戏设计的特定约束和启示。特别是，生成内容的一个关键要求是它必须是可玩的——它应该有可能完成生成的关卡，登上生成的楼梯，使用生成的武器或赢得生成的游戏。

术语“过程”和“生成”意味着我们正在处理创建某物的计算机过程或算法。PCG 方法可以由计算机运行（可能需要人工帮助），并将输出一些东西。PCG 系统是指将 PCG 方法作为其一部分的系统，例如自适应游戏或人工智能辅助游戏设计工具。这本书将包含大量关于算法的讨论和相当多的伪代码，伴随章节的大多数练习都将涉及编程。

为了使讨论更加具体，我们将列出一些我们认为是 PCG 的东西：

- 一种软件工具，无需任何人工输入即可为《塞尔达传说》等动作冒险游戏创建地下城——每次运行该工具，都会创建一个新关卡；
- 一个在太空射击游戏中根据玩家集体的行为创建新武器的系统，这样玩家面前的武器就是其他玩家觉得有趣的武器的进化版本；
- 一个可以自己生成完整、可玩和平衡的棋盘游戏的程序，也许可以使用一些现有的棋盘游戏作为起点；
- 游戏引擎中间件，可快速用植被填充游戏世界；
- 一个图形设计工具，让用户为策略游戏设计地图，同时不断评估设计的地图的游戏属性，并建议对地图进行改进，使其更加平衡和有趣。

在接下来的章节中，您将找到对上述所有内容的描述。现在让我们列出一些我们不认为是 PCG 的东西：

- 战略游戏的地图编辑器，只需让用户放置和删除物品，而无需采取任何主动或自行生成；
- 棋盘游戏的人造玩家；
- 能够集成自动生成植被的游戏引擎。

其他几位作者已经解决了测量 PCG 或我们称之为 PCG 的部分领域的问题，尽管重叠远未完成[12,25]。

## 1.2 为什么使用程序内容生成？

现在我们知道 PCG 是什么了，让我们讨论一下使用和开发这些方法的原因。事实证明，有许多不同的原因。

也许生成内容最明显的原因是，它消除了让人类设计师或艺术家生成内容的需要。人类既昂贵又缓慢，似乎我们一直都需要越来越多的人类。自从电脑游戏被发明以来，开发一款成功的商业游戏所需的人月数或多或少都在不断增加。（[1]：至少对于“AAA”级游戏来说是这样，这些游戏是在全球范围内以全价销售的盒装游戏。最近手机游戏的兴起似乎使单人开发再次可行，尽管这方面的平均开发成本也在上升。）现在，数百人在一年或更长时间内开发游戏是很常见的。这导致了一种情况，即盈利的游戏越来越少，能够负担得起开发游戏的开发者也越来越少。这反过来又导致了游戏市场的风险降低和多样性降低。在这个过程中，许多昂贵的员工都是设计师和艺术家，而不是程序员。一家可以用算法取代一些艺术家和设计师的游戏开发公司将具有竞争优势，因为游戏可以在保持质量的同时更快、更便宜地生产。（传奇游戏设计师 Will Wright 在 2005 年游戏开发者大会上的“内容的未来”演讲中有力地提出了这一论点，这场演讲有助于重振人们对程序化内容生成的兴趣。）

当然，威胁要解雇他们并不能把 PCG 卖给设计师和艺术家。因此，我们可以扭转这一论点：内容生成，特别是嵌入智能设计工具中的内容生成，可以增强单个人类创作者的创造力。这可以让没有大公司资源的小团队，甚至是业余爱好者，通过摆脱对细节和繁重工作的担忧，同时保留游戏的总体导演权，创造出内容丰富的游戏。

这两个论点都假设我们想要制作的是我们今天拥有的游戏。但 PCG 方法也可以实现全新类型的游戏。首先，如果我们有可以以“消费”（玩）的速度生成游戏内容的软件，原则上没有理由让游戏结束。对于那些曾经对自己最喜欢的游戏没有更多关卡需要通关、角色需要见面、区域需要探索等感到失望的人来说，这是一个令人兴奋的前景。

更令人兴奋的是，新生成的内容可以根据玩游戏的玩家的口味和需求进行定制。通过将 PCG 与玩家建模相结合，例如通过测量和使用神经网络来模拟玩家对单个游戏元素的反应，我们可以创建玩家自适应游戏，寻求最大限度地提高玩家的乐趣。同样的技术可以用来最大限度地提高严肃游戏的学习效果，或者可能是“休闲”游戏的成瘾性。

使用 PCG 的另一个原因是它可能有助于我们更有创造力。人类，即使是那些“有创造力”的人，也倾向于模仿彼此和自己。通过为给定的内容生成问题提供意外但有效的解决方案，算法方法可能会产生与人类创建的内容截然不同的内容。在游戏之外，这是进化设计等领域的一个众所周知的现象。

最后，开发 PCG 方法的一个完全不同但同样重要的原因是理解设计。计算机科学家喜欢说，只有在代码中实现了一个过程（并且程序运行了），你才能真正理解它。创建能够胜任生成游戏内容的软件可以帮助我们理解我们“手动”生成内容的过程，并阐明我们正在解决的设计问题的启示和约束。这是一个迭代过程，更好的 PCG 方法可以更好地理解设计过程，从而产生更好的 PCG 算法。

## 1.3 使用 PCG 的游戏

克服计算机的存储限制是 PCG 技术发展的主要动力之一。20 世纪 80 年代初，家用电脑的有限功能限制了存储游戏内容的空间，迫使设计师寻求其他生成和保存内容的方法。Elite [4] 是解决这个问题的早期游戏之一，它存储了用于程序化生成八个星系的种子号，每个星系有 256 个行星，每个行星都有独特的属性。PCG 早期使用的另一个经典例子是 20 世纪 80 年代初的游戏《Rogue》，这是一款地牢爬行游戏，每次新游戏开始时都会随机生成关卡。然而，自动生成游戏内容往往伴随着权衡；roguelike 游戏可以自动生成引人注目的体验，但其中大多数（如《矮人要塞》[1]）缺乏视觉吸引力。

程序内容生成在商业游戏中受到越来越多的关注。暗黑破坏神[2]是一款动作角色扮演的砍杀视频游戏，其特点是创建地图的程序生成，以及物品和怪物的类型、数量和位置。PCG 是 Spore[15]中的一个核心功能，玩家创建的设计使用程序动画技术进行动画制作。然后，这些个性化的生物被用来填充程序生成的星系。《文明 IV》[10]是一款回合制策略游戏，通过生成随机地图来提供独特的游戏体验。Minecraft 是一款广受欢迎的游戏，它广泛使用 PCG 技术来生成整个世界及其内容。Spelunky [39,38] 是另一款著名的 2D 平台 roguelike 独立游戏，它利用 PCG 自动生成游戏关卡的变体（图1.1）。Tiny Wings[13] 是移动 2D 游戏的另一个例子，它具有程序地形和纹理生成系统，使游戏在每次重播时都有不同的外观

图1.1: Spelunky 的屏幕截图

## 1.4 PCG 的愿景

正如我们所看到的，三十年来，程序内容生成一直是一些已发布游戏的一部分。在过去的几年里，关于 PCG 的学术研究也激增，来自不同学术背景的研究人员对游戏内容生成问题提出了自己的观点和方法。这导致了许多新方法，以及旧方法的变体和组合，其中一些在实际游戏中有用之前需要进一步的研究和开发。本书的章节将介绍近年来研究的许多最重要的贡献。

为了指导正在进行的研究，对我们可能要去的地方有一些愿景是有用的；这类似于数学和物理等一些研究领域的“未解决问题”列表。最近一篇调查论文的作者为程序内容生成定义了三种这样的愿景[31]。这些是我们用当前技术无法做到的事情，也可能永远不可能完全按照所述实现，但有助于指出最新技术的局限性，并延伸到需要解决的有趣问题。

1. 多层次、多内容 PCG 是指一种内容生成器，对于给定的游戏引擎和游戏规则集，它能够生成游戏的所有内容，使内容具有高质量并完美地组合在一起。例如，给定流行的计算机角色扮演游戏 Skyrim 的引擎和规则集，这个虚构的软件将生成背景故事、任务、角色、物品、武器、植被、地形、图形等，使其成为一个连贯、可信的新世界和一个愉快的游戏。
2. 基于 PCG 的游戏设计是指创建的游戏不仅依赖于程序内容生成，而且 PCG 是游戏玩法的绝对核心部分，这样如果你拿走了内容生成部分，游戏就不会留下任何可识别的东西。在这方面已经取得了一些进展，特别是在《银河军备竞赛》[11]和《无尽的网络》[28]等游戏中，但这些游戏仍然基于既定的游戏类型，游戏的核心部分可以在没有 PCG 的情况下运行。
3. 生成完整游戏是指不仅能够为给定游戏生成内容，而且能够为游戏本身生成内容的生成器。这意味着规则、奖励结构和图形表示，以及级别、角色等。在这方面已经做了一些工作，主要是为不同类型的游戏生成规则[33,7,20,9]，但到目前为止，生成的规则相当简单。

在接下来的章节中描述的大部分工作可以被视为朝着其中一个或几个愿景取得进展，但是，正如你将看到的，还有很多工作要做。同时，重要的是要记住，为更狭义的任务开发生成器同样值得。

## 1.5 PCG 解决方案的理想特性

我们可以将 PCG 方法的实现视为内容生成问题的解决方案。内容生成问题可能是生成细节水平较低的新草，在 50 毫秒内看起来并不完全奇怪。它也可能是在经过数天的计算时间后，为游戏机制生成一个真正原创的想法，或者可能是在设计师编辑游戏中的物品时，在背景线程中将其打磨成完美的光泽。解决方案的理想或所需属性对于每个应用程序都是不同的。唯一不变的是，通常会涉及权衡，例如在速度和质量之间，或表现力/多样性和可靠性之间。以下是 PCG 解决方案的常见理想属性列表：

- 速度：对速度的要求差异很大，从几毫秒到几个月不等，具体取决于（除其他外）内容生成是在游戏过程中还是在游戏开发过程中完成的。
- 可靠性：一些生成器是即兴的，而另一些生成器则能够保证它们生成的内容满足某些给定的质量标准。对于某些类型的内容来说，这比其他类型的内容更重要，例如，一个没有出口或入口的地牢是一个灾难性的失败，而一朵看起来有点奇怪的花看起来有点怪异，但这并不一定会破坏游戏。
- 可控性：通常需要内容生成器在某种意义上是可控的，以便人类用户或算法（如玩家自适应机制）可以指定要生成的内容的某些方面。控制有很多可能的维度，例如，人们可能会要求一块光滑的长方形岩石，一辆可以急转弯并有多种颜色的汽车，一个能引起神秘感并奖励完美主义者的关卡，或者一个不受机会影响的小规则集。
- 表现力和多样性：通常需要生成一组多样化的内容，以避免内容看起来像是对一个疲惫主题的微小变化。在非表达性的极端，考虑一个水平“生成器”，它总是输出相同的水平，但在水平中间随机改变单个石头的颜色；在另一个极端，考虑一个完全随机组装组件的“关卡”生成器，产生无意义和不可播放的关卡。衡量表现力本身就是一个不平凡的话题，设计在不影响质量的情况下生成多样化内容的级别生成器就更不平凡了。
- 创造力和可信度：在大多数情况下，我们希望我们的内容看起来不像是由程序化内容生成器设计的。生成的内容可以通过多种方式看起来是生成的，而不是人工创建的。

## 1.6 PCG 的分类

随着现在可用的各种内容生成问题和方法的出现，有一个能够突出方法之间异同的结构是有帮助的。在下文中，我们介绍了最初由 Togelius 等人提出的 PCG 分类学的修订版本[34]。它由多个维度组成，其中单个方法或解决方案通常应被视为位于该维度两端之间的连续体上的某个地方。

### 1.6.1 线上与线下

PCG 技术可用于在玩家玩游戏时在线生成内容，允许生成无尽的变化，使游戏无限可重放，并打开生成玩家自适应内容的可能性，或在游戏开发期间或游戏会话开始之前离线生成内容。在生成环境和地图等复杂内容时，使用PCG进行离线内容生成特别有用。在线内容生成的一个例子可以在游戏《Left 4 Dead[35]》中找到，这是一款最近发布的第一人称射击游戏，通过实时分析玩家行为并使用PCG技术相应地改变游戏状态，为每个玩家提供动态体验[3]。

NERO[30] 是使用人工智能技术让玩家为虚拟士兵队伍制定实时战术的一个例子。《极限竞速赛车》[17]是一款赛车游戏，非玩家角色（NPC）可以离线训练以模仿玩家的驾驶风格，以后可以用来代表玩家驾驶。离线内容生成的另一个重要用途是创建和共享内容。一些游戏，如《小小大星球》[16]和《孢子》[15]，提供了一个内容编辑器（在《小小大行星》和《孢子生物创造者》的情况下是关卡编辑器），允许玩家编辑并上传完整的生物或关卡到中央在线服务器，其他玩家可以在那里下载和使用。

### 1.6.2 必要与可选

PCG 可用于生成完成关卡所需的必要游戏内容，也可用于生成可以丢弃或交换为其他内容的辅助内容。必要内容和可选内容之间的主要区别在于，必要内容应该始终正确，而可选内容则不符合这一条件。可选内容的一个例子是在第一人称射击游戏中生成不同类型的武器，或者在《超级马里奥兄弟》中生成辅助奖励物品[21]。必要的内容可以是《超级马里奥兄弟》中关卡的主要结构，也可以是进入下一关卡所需的某些物品的集合。

### 1.6.3 控制程度和尺寸

PCG 的内容生成可以通过不同的方式进行控制。使用随机种子是获得对生成空间的控制的一种方式；另一种方法是使用一组参数来控制沿多个维度的内容生成。在 Minecraft 中生成世界时使用了随机种子[19]，这意味着如果使用相同的种子，可以再生相同的世界[18]。[24]中使用了内容特征向量来为《无尽马里奥兄弟》[22]生成满足一组特征规范的关卡。

### 1.6.4 通用与自适应

通用内容生成是指 PCG 的范式，其中生成内容时不考虑玩家行为，而不是自适应、个性化或以玩家为中心的内容生成，其中分析玩家与游戏的互动，并根据玩家之前的行为创建内容。大多数商业游戏都以通用的方式处理 PCG，而自适应 PCG 最近在学术界越来越受到关注。最近对 PCG 在玩家自适应游戏中的广泛回顾可以在[37]中找到。

Left 4 Dead[35]是在商业游戏中使用自适应 PCG 的一个例子，其中使用算法根据玩家的情绪强度动态调整游戏的节奏。在这种情况下，自适应 PCG 用于调整游戏的难度，以保持玩家的参与[3]。自适应内容生成还可以与另一个动机一起使用，例如生成玩家似乎喜欢的更多内容。这种方法在银河军备竞赛游戏中得到了遵循，在游戏中，呈现给玩家的武器是根据她之前的武器使用和偏好而演变的。图 1.2 展示了不同玩家的进化武器示例。

图1.2：银河军备竞赛游戏中为不同玩家创建的三个示例武器。改编自[11]

### 1.6.5 随机与确定性

确定性 PCG 允许在给定相同的起点和方法参数的情况下重新生成相同的内容，而随机 PCG 通常无法重新创建相同的内容。Elite[4] 中星系的再生是 PCG 确定性使用的一个例子。

### 1.6.6 建设性与生成和测试

在构造性 PCG 中，内容是一次生成的，就像 roguelike 游戏中常见的那样。另一方面，生成和测试 PCG 技术，在循环中交替生成和测试，重复直到生成令人满意的解决方案。Yavalath[5] 是一款完全由计算机程序使用生成和测试范式生成的双人棋盘游戏[7]。

### 1.6.7 自动生成与混合作者

直到最近，PCG 还允许游戏设计师提供有限的输入，他们通常会调整算法参数来控制和指导内容生成，而 PCG 的主要目的仍然是生成无限变化的可玩内容[39,7,1,2]。然而，一种新的有趣的范式已经出现，它侧重于通过设计过程整合设计师和/或玩家的输入。在这种混合主动范式中，人类设计师或玩家与算法合作生成所需的内容。

Tanagra[29] 是一个系统的例子，其中设计者绘制了2D关卡的一部分，并使用约束满足算法来生成缺失的部分，同时保持可玩性。另一个例子是 SketchaWorld 框架[26]，这是一个用于创建景观和城市景观的交互式程序草图系统，设计师可以在保持虚拟世界模型一致的同时手动编辑和调整生成的结果。Ropossum[23] 是最近使用 PCG 完成未完成设计的另一个例子，它建议对基于 2D 物理的游戏《割绳子》进行修改、处理约束和可玩性测试[40]。

## 1.7 PCG 的隐喻

在“程序性内容生成系统”一词中，我们讨论了“程序性”、“内容”和“生成”的含义。但是单词系统呢？PCG 系统是执行 PCG 的任何软件的通用术语。但这些系统做不同的事情，以不同的方式使用，与整个游戏设计过程有着截然不同的关系。一些 PCG 系统试图帮助设计师完成设计过程的一小部分。其他人则试图提供一种处理游戏内容的新方法。有些是互动的；其他人没有。有些旨在进行完全自主、创造性的游戏设计；其他人的目标是自动化设计的常规或常见方面。

为了将 PCG 系统这一广义术语分解为更具体的系统类型，Khaled 等人[14]提出了四个隐喻来思考 PCG 系统与游戏设计过程的关系。一些 PCG 系统是工具：像程序员的开发环境或建筑师的 CAD 系统一样，为设计师提供增强功能的工具。其他系统定义了新的材料，允许设计师在新的媒介中工作，就像石头、粘土和激光装置对艺术家来说是不同的材料一样。一些 PCG 系统本身就是设计师，对部分甚至整个游戏进行完全自主的设计，而不是协助游戏设计师。最后，一些系统主要是领域专家，他们拥有丰富的游戏设计知识，可用于批评或改进设计。许多系统可以通过其中一个以上的镜头观看，尽管很少有人能平等地展示所有这些镜头。

PCG 工具和非 PCG 设计工具一样，旨在改善设计师的工作流程，但 PCG 工具是通过添加生成组件来实现的。一个常见的例子是 PCG 增强级别编辑器。许多游戏引擎中包含的关卡编辑工具已经通过提供专门的编辑和布局关卡的方法来改进关卡设计过程，而不是让设计者必须在更通用的工具中或完全在代码中进行关卡设计。PCG 增强的级别编辑器在传统的被动级别编辑器的基础上添加了生成组件。Tanagra[29] 关卡编辑器生成符合平台游戏节奏模式理论的关卡，设计者可以修改并添加更多约束，然后重新生成相关部分。这种来回模式，交替的过程内容生成和人工编辑，被称为混合主动生成，在第 11 章中有所介绍。在本章前面讨论的 PCG 愿景中，“多层次多内容 PCG”可以被视为使用工具隐喻。

PCG 系统还可以创建新的生成材料，游戏设计师可以操纵和雕刻这些材料来制作内容。一个流行的商业例子是 SpeedTree。从某种意义上说，它是一种设计树木作为视频游戏中风景的工具。但它做到这一点的方式是将树木变成一种交互式的生成材料：设计师可以点击并拖动它们，添加和删除树枝等，它们总是看起来像一棵树，因为树木是在设计师操纵它们时实时生成的。第 4 章讨论的分形景观也是一种程序生成材料，设计师可以操纵它来产生他们想要的景观。对于“基于 PCG 的游戏设计”的 PCG 愿景，恰当的隐喻是物质的。

程序化内容设计师与人类设计师的互动较少，而是有独立设计内容的野心。在极限情况下，PCG 设计师变成了一个完全自主的游戏生成器，通常在特定类型中创建新游戏。自动游戏设计的工作仍处于探索阶段，但存在有前景的原型系统[20,33,7,9]。首席设计师面临的一个关键挑战是，它不仅要设计游戏中的内容，还要设计游戏本身的规则。第 6 章着眼于这些生成规则和游戏机制的系统。PCG “生成完整游戏”的愿景依赖于设计师的隐喻。

程序领域专家是一种略有不同的系统，充满了关于游戏或玩家的知识，能够将其应用于评论和修改内容。通常，它会通过成为系统的一部分来应用这种专业知识，该系统也可以作为工具或设计师。领域专家可能对游戏有纯粹的形式知识，比如是什么让一组特定的规则变得优雅[6]。或者，它可能对人类玩家有广泛的了解，能够预测人们在游戏中会做什么，以及他们会发现什么具有挑战性、乐趣或无聊。对于基于 PCG 的教育游戏，领域专家可能具有教育知识。例如，分数教学游戏“折射”中的程序级别生成受到限制，因此生成的级别符合系统的教学目标[27]。第 10 章讨论了经验驱动的 PCG 方法，该方法构建了玩家行为和反应方面的专家 PCG 系统。

## 1.8 本书概述

本书由一系列章节组成，由本书的主要作者和每章主题的主要专家共同撰写。大多数章节的组织方式是，它们既介绍了一系列方法（如分形或语法），也介绍了一个应用领域（如植物或地下城）。该方法通常通过应用领域中的示例进行介绍，然后本章还讨论了如何将相同的方法用于其他领域，或者如何将不同的方法用于该领域。这种结构的部分动机是 PCG 研究和实践的跨学科性质，其中使用的算法来自许多不同的领域（因此很少相互建立），游戏设计知识在所有情况下都是至关重要的。每一章都以总结结束，通常还会以拟议的实验练习结束。

在第 2 章中，我们介绍了基于搜索的程序内容生成方法，该方法非常通用，最近已被用于大量学术研究项目和一些已发布的游戏中。在基于搜索的方法中，进化算法用于使用达尔文进化论的原理来搜索好的游戏内容。构建基于搜索的内容生成器时的两个主要挑战是评估候选内容伪影的评估函数和定义算法搜索空间的内容表示。虽然本章包含了几个基于人工进化的内容生成器的示例，但在接下来的章节中还会有更多这样的示例。

第 3 章讨论了为 roguelike 游戏创建地下城的具体示例，以及基于导航二维空间的类似关卡，例如平台游戏或第一人称射击游戏的关卡。描述了用于生成此类级别的许多快速和有建设性的算法。其中一些算法来自游戏开发社区，广泛应用于《暗黑破坏神》等 Roguelike 游戏中。其他一些，如细胞自动机，起源于物理学。我们还介绍了马里奥AI框架，这是一个基于《超级马里奥兄弟》克隆版的关卡生成算法的通用测试平台。

第四章介绍了几种具有计算机图形学研究背景的算法，即简单分形算法和其他噪声算法。这些通常用于生成地形和完整的景观，以及云等纹理和特征。虽然这些算法快速可靠，但它们缺乏某种形式的可控性。因此，提出了另外两种生成景观的方法，一种基于搜索，另一种基于代理集合。

第五章是语法。语法在计算机科学和语言学中很常见，被证明对创建多种类型的游戏内容非常有用。本章从创建逼真植物的例子开始，这是 PCG 的一种非常常见的形式；事实上，近年来数百款 AAA 游戏都以基于语法的程序生成植被为特征。但语法也可用于例如级别生成；本章的其余部分详细介绍了如何使用语法为塞尔达风格的动作冒险游戏生成关卡和任务，以及如何进化生成《超级马里奥兄弟》关卡的语法。

虽然前几章的一些应用领域可能被视为有点边缘化，但第 6 章解决了生成任何游戏中绝对最核心部分的问题：它的规则。我们描述了从棋盘游戏到纸牌游戏和街机游戏生成游戏规则的许多不同尝试。其中一些尝试是建设性的，但大多数都是以某种方式基于搜索的。本章还介绍了视频游戏描述语言，这是一种为20世纪80年代初常见的简单街机游戏编码游戏规则的方法——这种语言的目的之一是能够自动生成完整的游戏。

大多数游戏都有某种故事，无论是背景故事还是玩家可以影响的互动故事；故事可以被视为内容，因此第7章专门讨论游戏故事的生成。事实证明，几乎所有的故事生成方法都是基于规划算法的；规划是一种经典的人工智能方法，最初是为机器人控制而开发的，现在广泛应用于各个领域。本章还讨论了如何将故事生成与地图生成相结合，从而生成与生成的故事相匹配的游戏地图。

第 8 章重点介绍一种方法，即答案集编程（ASP）。这是一种逻辑编程加约束满足的形式：内容生成方法加条件用一种称为 AnsProlog 的语言指定，求解器生成与指定条件兼容的所有内容配置。虽然这看起来相当抽象和数学化，但最近已经证明，某些 PCG 问题可以很容易地用 AnsProlog 形式表示，求解器的结果被解释为游戏内容。这产生了一种高效的方法来创建某种形式的游戏内容，例如益智游戏的关卡。

第 9 章回到第 2 章的主题，基于搜索的 PCG，并详细讨论了如何表示游戏内容的问题。表示法很重要，因为它定义了搜索空间的形状以及探索搜索空间的方式。本章演示了明智的表示选择如何改变生成内容的风格，以及如何更有效地搜索更符合评估函数的内容。示例包括表示为神经网络的花朵和表示为代理集合的级别生成器。

PCG 的动机之一是它可以实现玩家自适应游戏。第 10 章描述了一个使游戏适应玩家的框架，即体验驱动的 PCG 框架。我们描述了基于从玩家收集的数据创建玩家体验模型的不同方法。

贯穿本书大部分内容的一个主题是，程序化内容生成与人类游戏设计师之间的关系可能非常不同。PCG 可以以高度自动化的方式使用，但也可以与设计师自己的设计选择紧密结合使用。第 11 章明确地研究了这种紧密耦合，考虑了混合主动系统，在这种系统中，人类设计师和程序化内容生成系统协作生成内容。

最后，第 12 章讨论了 PCG 解决方案实施后如何评估其质量。

## 1.9 总结

游戏中的程序性内容生成（PCG）是在有限或间接用户输入的情况下通过算法创建游戏内容。PCG 方法的开发和使用有许多不同的原因，包括节省开发时间和成本、提高可重放性、允许自适应游戏、协助设计师以及研究创造力和游戏设计。虽然自 20 世纪 80 年代初以来，PCG 算法已被用于一些商业游戏中，但它们通常要么用于外围角色，要么其范围非常有限；学术界目前的研究正试图突破可以生成什么以及可以生成什么质量的界限。理想情况下，PCG 解决方案应该是快速、可靠、可控、富有表现力和创造性的，但在实践中，需要在这些属性之间进行某些权衡。PCG 解决方案可以根据相对广泛的分类法进行分类，这可能有助于确定它们的优缺点。理解 PCG 系统的另一个视角是使用它的隐喻；在这里，我们可以区分将系统用作工具、材料、设计师或领域专家。PCG 算法来自各种不同的领域，从本书的目录中可以明显看出这种方法的多样性。

# 第 2 章 基于搜索的方法

Julian Togelius and Noor Shaker

**摘要**

基于搜索的程序内容生成是使用进化计算和类似方法生成游戏内容。本章概述了这种 PCG 方法，并列出了开发基于搜索的 PCG 解决方案的一些核心考虑因素。特别是，我们讨论了如何最好地表示内容，以便内容空间变得可搜索，以及如何创建一个允许有效搜索的评估函数。给出了三个使用基于搜索的 PCG 来为特定游戏进化内容的较长示例。

## 2.1 基于搜索的程序内容生成方法是什么？

为游戏生成内容有许多不同的方法。在本章中，我们将介绍基于搜索的方法，该方法近年来在学术 PCG 研究中得到了深入的研究。在基于搜索的程序内容生成中，使用进化算法或一些其他随机搜索/优化算法来搜索具有所需质量的内容。基本的比喻是将设计视为一个搜索过程：设计问题的一个足够好的解决方案存在于某个解决方案空间内，如果我们不断迭代和调整一个或多个可能的解决方案，保留那些使解决方案更好的更改，并丢弃那些有害的更改，我们最终将得到所需的解决方案。这个比喻被用来描述许多不同学科的设计过程：例如，Will Wright（《模拟城市》和《模拟人生》的设计师）在 2005 年游戏开发者大会上的演讲中将游戏设计过程描述为搜索[30]。其他人之前已经对设计过程进行了总体描述，在建筑等其他专业领域，设计过程可以被概念化为搜索，并实现为计算机程序[29,2]。

解决内容生成问题的基于搜索的方法的核心组成部分如下：

- 搜索算法。这是基于搜索的方法的“引擎”。正如我们将看到的，通常相对简单的进化算法工作得很好，尽管有时使用更复杂的算法会有很大的好处，例如考虑约束，或者专门用于特定内容表示。
- 内容表示。这是您想要生成的人工制品的表示，例如关卡、任务或带翅膀的小猫。内容表示可以是从实数数组到图形再到字符串的任何形式。内容表示定义了（因此也限制了）可以生成的内容，并决定了是否可以进行有效的搜索。
- 一个或多个评估功能。评估函数是从工件（单个内容）到指示工件质量的数字的函数。评估函数的输出可以指示例如关卡的可玩性、任务的复杂性或有翼小猫的美学吸引力。在开发基于搜索的 PCG 方法时，制作一个可靠地衡量游戏质量方面的评估函数通常是最困难的任务之一。

本章将依次介绍这些组件中的每一个。它还将讨论基于搜索的方法的几个示例，用于为不同类型的游戏生成不同类型的内容。

## 2.2 进化搜索算法

进化算法是一种随机搜索算法，其灵感来源于达尔文通过自然选择进化论。核心思想是保留一个个体群体（也称为染色体或候选解决方案），在每一代中对其进行评估，最适合（评估最高）的个体有机会繁殖，最不适合的个体从群体中删除。因此，一代人可以被视为分为选择和繁殖阶段。在你的后院，一代新生的兔子可能会被吃得最慢的饥饿狼选中，幸存的兔子可以繁殖。平均而言，下一代兔子可能更擅长躲避狼。同样，在基于搜索的 PCG 实现中，一代策略游戏单元可能会受到评估函数的选择，该函数根据它们的互补程度对它们进行评分，然后相互混合（重组或交叉）或以小的随机变化进行复制（突变）。平均而言，下一代战略游戏单元可能更具互补性。值得注意的是，即使初始代由随机生成的个体组成，这些个体都非常不适合这一目的，这一过程也会奏效；有些人会比其他人更有价值，一个设计良好的评估函数会反映这些差异。

更具体地说，让我们描述一个简单但完全可用的进化算法，µ+λ 进化策略（ES）。参数µ表示世代之间保留的人口部分，即精英的规模；参数λ表示每一代通过繁殖产生的种群部分的大小。为简单起见，在阅读以下描述时，想象µ = λ = 50。

1. 初始化 µ + λ 个体的群体。这些个体可以是随机生成的，也可以包括一些手工设计的个体或之前进化运行的结果。
2. 对人群进行洗牌（随机排列）。此阶段是可选的，但有助于避免梯度损失的情况。
3. 使用评估函数或几个评估函数的某种组合来评估所有个体，以便为每个个体分配一个表示其适合度的单一数值。
4. 按健康度升序对人群进行排序。
5. 删除 λ 最差的个体。
6. 将 λ 去除的个体替换为µ剩余个体的副本。新制作的副本称为后代。如果 µ = λ，精英中的每个人都会被复制一次；否则，它可能会被复制更少或更多次。
7. 对 λ 后代进行突变，即随机扰乱它们。最合适的变异算子取决于表示，并在一定程度上取决于适应度景观。如果表示是实数向量，一个有效的变异算子是高斯变异：将从具有小标准偏差的高斯分布中提取的随机数添加到向量中的所有数字上。
8. 如果人口中有足够素质的个体，或者达到了最大世代数，则停止。否则，转到步骤2（即启动下一代）。

尽管该算法简单（可以用 10-20 行代码实现），但 µ + λ ES 可以非常有效；即使是像 1+1 ES 这样的退化版本也可以很好地工作。然而，进化策略只是几种进化算法中的一种；另一种常用的类型是遗传算法，它更多地依赖于重组，更少地依赖于突变，并使用不同的选择机制。还有几种类型的随机搜索/优化算法，严格来说不是进化算法，但可以用于相同的目的，例如粒子群优化和蚁群优化等群体智能算法。进化算法和一些相关方法的良好概述可以在 Eiben 和 Smith 的书[8]中找到。

一些进化算法特别适合特定类型的表示。例如，进化算法的许多变体已经开发出来，特别是用于进化可运行的计算机程序，通常表示为表达式树[18]。如果将伪影表示为相对较短长度（低维）的实数向量，则一种特别有效的算法是协方差矩阵自适应进化策略（CMA-ES），该策略有几种开源实现[9]。

在许多情况下，我们希望使用多个评估函数，因为很难在一个数字中捕捉到工件质量的所有方面。在标准的单目标进化算法（如进化策略）中，评估函数可以组合为加权和。然而，这也带来了一系列问题，特别是一些功能往往以牺牲其他功能为代价进行优化。相反，人们可以使用多目标进化算法，该算法同时优化多个目标，并找到具有独特优势组合的非支配个体集。最流行的多目标进化算法可能是 NSGA-II[7]。

### 2.2.1 其他类型的搜索算法

可以说，进化算法对于某些内容生成问题来说是“矫枉过正”的。如果你的搜索空间很小，或者你手头有很多时间来生成你的内容，你可以尝试一种穷举的搜索算法，它只是迭代所有可能的配置。在其他情况下，当很容易找到好的解决方案，并且更重要的是在生成的内容中保持高度的多样性时，随机搜索——简单地在搜索空间中采样随机点——可以很好地工作。即使在使用穷举或随机搜索时，内容也需要以这样的方式表示，即可以有效地搜索/采样空间，并且需要一个评估函数来区分好坏内容。

另一种也可以被视为内容空间搜索的内容生成方法是基于求解器的方法，例如，答案集编程用于指定游戏内容的逻辑条件。第 8 章将讨论这种方法。

## 2.3 内容表示

在演化游戏内容时，内容表示是一个非常重要的问题。所选择的表示对生成算法的效率和该方法能够覆盖的内容空间起着重要作用。在进化算法中，生成空间中的解通常被编码为基因型，用于高效搜索和评估。基因型随后转化为表型，实际的实体正在进化。在游戏内容生成场景中，基因型可能是创建游戏关卡的指令，表型是实际的游戏关卡。

游戏领域中的内容表示的例子包括 Togelius 等人[26]所做的工作，他们使用间接表示来为实时战略游戏《星际争霸》[1]进化地图。在这个实验中，图谱的基因型只是实数数组，而表型是完整的星际争霸图谱，包括可通行/不可通行的区域、基地和资源的位置等。第2.5节将更详细地讨论这个实验。

在另一种游戏类型中，Cardamone 等人[4]为赛车游戏开发了赛道。这些轨迹被表示为轨迹必须覆盖的一组控制点，并采用贝塞尔曲线来连接这些点并确保平滑度，这种方法的灵感来自 Togelius 等人[24]在同一游戏类型上所做的工作。图2.1中给出了遵循此方法演变的示例轨迹。这项工作将在第2.6节中进一步讨论

图2.1：基于 Bézier 曲线序列演变的轨迹。改编自[24]

作为不同表示的具体示例，《超级马里奥兄弟》中的一个关卡可以用以下任何一种方式表示。

1. 直接作为水平图，其中基因型中的每个变量对应于表型中的一个“块”（例如砖块、问号块等）。
2. 更间接地，作为不同游戏实体（如敌人、平台、缺口和山丘）的位置和属性列表（可以在[19]中找到一个例子）。
3. 更间接地说，作为不同可重复使用模式（如硬币或山丘的集合）的存储库，以及它们在水平图上的分布方式（包括旋转和缩放等各种变换）的列表（可以在[23]中找到一个例子）。
4. 非常间接地，作为理想属性的列表，如间隙数量、敌人、硬币、间隙宽度等。（一个例子可以在[20]中找到）。
5. 最间接的是，作为随机数种子。

这些表示产生了非常不同的搜索空间。人们很容易认为，最好的代表是最直接的代表，这使进化过程对表型有最大的控制权。然而，人们应该意识到与产生大搜索空间的表示相关的“维度灾难”：搜索空间越大，就越难（通常）找到某种解决方案。另一个有用的原则是，表示应具有较高的局部性，这意味着基因型的微小变化平均应导致表型的微小变化和适应度值的微小变化。从这个意义上说，最后一种表示不适合基于搜索的 PCG，因为没有局部性，在这种情况下，所有搜索方法的性能都与随机搜索一样差（或一样好）。

适当表示的选择取决于一个人试图解决的问题的类型。在 Shaker 等人[20]的工作中，根据选项4，将流行游戏《超级马里奥兄弟》[14]的公开克隆版《无限马里奥兄弟》的关卡表示为整数向量；每个级别由四个选定的内容特征参数化，目的是找到这些特征的最佳组合，以生成优化特定玩家体验的内容。在同一作者[19]的后续研究中，在选项2之后使用了更具表现力的表示，其中同一游戏的关卡结构在设计语法中进行了描述，该语法指定了要放置在关卡图中的每个项目的类型、位置和属性。然后将语法进化应用于设计语法，以进化出新的关卡设计[15]。[23] 中提出了一组设计元素，遵循选项3，也在同一款游戏中，其中关卡被描述为放置在 2D 地图中的设计元素列表；本研究采用标准遗传算法对内容进行进化。

与直接-间接连续体上的表示密切相关的一个问题是所选表示的表达范围。表现范围与它的特定度量有关：人们可以根据平台游戏级生成器可以产生多少不同配置的块来衡量它的表现力，但衡量一些与人类玩游戏体验更相关的质量会更有意义。例如，用于表示《无尽马里奥兄弟》关卡的四个特征向量表示只允许在所选的四个维度上控制生成，因此搜索空间受到这四个特征范围的限制。另一方面，当在设计语法中表示可能的级别设计时，构建了一个具有更宽表达范围的生成器，该语法对进化的结构施加了更少的约束。

第9章进一步讨论了基于搜索的 PCG 中的表示问题，并给出了针对特定内容生成需求量身定制的表示的其他示例。

## 2.4 评估功能

编码在表示中的候选解决方案由评估函数进行评估，该函数为每个候选方案分配一个分数（适应度值或评估值）。这对搜索过程至关重要；如果我们没有一个好的评价函数，进化过程就不会按预期进行，也不会找到好的内容。一般来说，评估函数的设计应该对文物的一些理想质量进行建模，例如它的可玩性、规律性、娱乐价值等。评估功能的设计在很大程度上取决于设计师，以及她认为应该优化的重要方面是什么，以及如何制定这些方面。

例如，有许多关于“有趣”游戏内容演变的研究 [25,24,20,4]。然而，这个术语的定义并不明确，很难衡量和正式化。许多作者从不同的角度探讨了这个问题。在一些研究中，乐趣被认为是玩家行为的一个函数，并相应地进行测量。这种方法的一个例子可以在 Togelius 等人 [25] 为发展有趣的赛车赛道所做的工作中找到。在这项研究中，球员表现的指标，如达到的平均速度，被用作衡量每个进化赛道对单个球员的适用性的指标。在 Shaker 等人 [20] 的另一项研究中，乐趣是通过直接询问玩家的体验来衡量的。在其他研究中 [22]，如果呈现的内容遵循预定义的模式，指定游戏中的区域并在不同挑战的片段之间交替，则游戏被认为是有趣的。在这种情况下，挑战被认为是有趣体验的主要原因。

在基于搜索的 PCG 中，我们可以区分三类评估函数：直接评估函数、基于模拟的评估函数和交互式评估函数。

### 2.4.1 直接评估功能

直接评估函数将从生成的内容中提取的特征映射到内容质量值，从这个意义上说，它们的适应度计算直接基于内容的表型表示。直接评估函数计算速度快，通常相对容易实现，但有时很难为游戏内容的某些方面设计直接评估函数。示例特征包括实时策略游戏中基础和资源的放置[26]或策略游戏中规则集的大小 [12]。特征和适应度之间的映射可能取决于玩家的游戏风格、偏好或情感状态的模型。这种健身形式的一个例子是 Shaker 等人 [20,21] 的研究，该研究使用玩家模型来衡量内容质量，从而个性化玩家体验。

在直接评估函数中，有两种主要类型是理论驱动函数和数据驱动函数。理论驱动的功能由直觉和/或玩家体验的定性理论指导。Togelius 等人 [24] 使用这种方法来评估赛车游戏中的赛道。得出的评估函数基于对游戏乐趣的几项理论研究 [6,11]，并结合作者对企业培训轨迹的直觉。另一方面，数据驱动功能基于玩家体验的定量测量，这些测量近似于所呈现内容与通过问卷或生理测量收集的玩家情感或认知状态之间的映射 [21,31]。

### 2.4.2 基于仿真的评估功能

基于模拟的评估功能使用 AI 代理来播放生成的内容并评估其质量。统计数据通常是关于代理人的行为和游戏风格的，并用于对游戏内容进行评分。评估任务的类型决定了 AI 代理的熟练程度。如果内容是基于可玩性来评估的，例如迷宫中从开始到结束的路径的存在，或者 2D 平台游戏中的关卡，那么 AI 代理的设计应该在到达游戏结束时表现出色。另一方面，如果内容被优化以最大限度地提高特定玩家的体验，那么通常会采用模仿人类行为的 AI 代理。